# ğŸš€ è¿è¡Œé¡¹ç›®å‰çš„å‡†å¤‡å·¥ä½œæ¸…å•

> ğŸ’¡ **æƒ³è¦æœ€ç®€å•çš„æ–¹å¼ï¼Ÿ** æŸ¥çœ‹ [å¿«é€Ÿå¯åŠ¨.md](./å¿«é€Ÿå¯åŠ¨.md) - 3æ­¥æå®šï¼

## ğŸ“‹ å‰ç½®è¦æ±‚æ£€æŸ¥

åœ¨è¿è¡Œé¡¹ç›®ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®Œæˆä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼š

---

## 1ï¸âƒ£ ç¯å¢ƒä¾èµ–å®‰è£…

### å¿…éœ€è½¯ä»¶

#### Dockeræ–¹å¼ï¼ˆæ¨èï¼‰
- âœ… **Docker 20.10+** 
  - ä¸‹è½½åœ°å€ï¼šhttps://www.docker.com/products/docker-desktop
  - Windows: å®‰è£… Docker Desktop
  - éªŒè¯ï¼š`docker --version`

- âœ… **Docker Compose 2.0+**
  - é€šå¸¸éš Docker Desktop ä¸€èµ·å®‰è£…
  - éªŒè¯ï¼š`docker-compose --version`

#### æœ¬åœ°å¼€å‘æ–¹å¼
- âœ… **Python 3.11+**
  - ä¸‹è½½åœ°å€ï¼šhttps://www.python.org/downloads/
  - éªŒè¯ï¼š`python --version` æˆ– `python3 --version`

- âœ… **PostgreSQL 15+**ï¼ˆå¦‚æœä¸ç”¨Dockerï¼‰
  - ä¸‹è½½åœ°å€ï¼šhttps://www.postgresql.org/download/
  - æˆ–ä½¿ç”¨ Dockerï¼š`docker run -d --name postgres -p 5432:5432 -e POSTGRES_PASSWORD=postgres123 postgres:15-alpine`

- âœ… **Redis 7+**ï¼ˆå¦‚æœä¸ç”¨Dockerï¼‰
  - ä¸‹è½½åœ°å€ï¼šhttps://redis.io/download
  - æˆ–ä½¿ç”¨ Dockerï¼š`docker run -d --name redis -p 6379:6379 redis:7-alpine`

- âœ… **Node.js 18+**ï¼ˆä»…å‰ç«¯å¼€å‘éœ€è¦ï¼‰
  - ä¸‹è½½åœ°å€ï¼šhttps://nodejs.org/
  - éªŒè¯ï¼š`node --version`

---

## 2ï¸âƒ£ è·å–LLM APIå¯†é’¥ï¼ˆå¿…éœ€ï¼‰

é¡¹ç›®éœ€è¦è‡³å°‘ä¸€ä¸ªLLM APIå¯†é’¥æ¥è¿è¡ŒAIæœåŠ¡ç”ŸæˆåŠŸèƒ½ã€‚

### æ¨èé€‰é¡¹ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

#### 1. Gemini API Keyï¼ˆâ­ æ¨èï¼‰
- **ä¸ºä»€ä¹ˆæ¨è**ï¼šå…è´¹é¢åº¦å¤§ï¼ŒMCPybarraé»˜è®¤ä½¿ç”¨
- **è·å–æ–¹å¼**ï¼š
  1. è®¿é—®ï¼šhttps://aistudio.google.com/app/apikey
  2. ç™»å½• Google è´¦å·
  3. åˆ›å»º API å¯†é’¥
  4. å¤åˆ¶å¯†é’¥ï¼ˆæ ¼å¼ï¼š`AIza...`ï¼‰

#### 2. Qwen API Keyï¼ˆå›½å†…æ¨èï¼‰
- **ä¸ºä»€ä¹ˆæ¨è**ï¼šå›½å†…è®¿é—®å¿«ï¼Œä»·æ ¼å®æƒ 
- **è·å–æ–¹å¼**ï¼š
  1. è®¿é—®ï¼šhttps://dashscope.aliyun.com/
  2. æ³¨å†Œ/ç™»å½•é˜¿é‡Œäº‘è´¦å·
  3. å¼€é€šé€šä¹‰åƒé—®æœåŠ¡
  4. åˆ›å»º API Key

#### 3. OpenAI API Keyï¼ˆå¤‡é€‰ï¼‰
- **è·å–æ–¹å¼**ï¼š
  1. è®¿é—®ï¼šhttps://platform.openai.com/api-keys
  2. ç™»å½• OpenAI è´¦å·
  3. åˆ›å»º API å¯†é’¥

#### 4. DeepSeek API Keyï¼ˆå¤‡é€‰ï¼‰
- **è·å–æ–¹å¼**ï¼š
  1. è®¿é—®ï¼šhttps://platform.deepseek.com/
  2. æ³¨å†Œ/ç™»å½•è´¦å·
  3. åˆ›å»º API å¯†é’¥

---

## 3ï¸âƒ£ é…ç½®ç¯å¢ƒå˜é‡

### æ­¥éª¤

1. **å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿**
   ```bash
   # åœ¨é¡¹ç›®æ ¹ç›®å½•
   cp backend/.env.example backend/.env
   ```

2. **ç¼–è¾‘ `.env` æ–‡ä»¶**
   ```bash
   # Windows: ç”¨è®°äº‹æœ¬æˆ–VS Codeæ‰“å¼€
   notepad backend/.env
   
   # Linux/Mac: ä½¿ç”¨nanoæˆ–vim
   nano backend/.env
   ```

3. **å¿…é¡»é…ç½®çš„é¡¹**ï¼ˆè‡³å°‘é…ç½®ä»¥ä¸‹å†…å®¹ï¼‰

   ```env
   # ========== å¿…éœ€é…ç½® ==========
   
   # LLM APIå¯†é’¥ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼‰
   GEMINI_API_KEY=your_gemini_api_key_here
   # æˆ–
   QWEN_API_KEY=your_qwen_api_key_here
   # æˆ–
   OPENAI_API_KEY=your_openai_api_key_here
   
   # æ•°æ®åº“å¯†ç 
   POSTGRES_PASSWORD=your_postgres_password
   
   # JWTå¯†é’¥ï¼ˆå»ºè®®32ä½ä»¥ä¸Šéšæœºå­—ç¬¦ä¸²ï¼‰
   SECRET_KEY=your-super-secret-key-change-this-in-production-min-32-chars
   ```

4. **å¯é€‰é…ç½®**ï¼ˆæ ¹æ®éœ€è¦ï¼‰

   ```env
   # åº”ç”¨é…ç½®
   DEBUG=true                    # å¼€å‘ç¯å¢ƒè®¾ä¸ºtrue
   API_PORT=8000                 # APIç«¯å£
   
   # æ•°æ®åº“é…ç½®ï¼ˆå¦‚æœä¸ç”¨Dockerï¼‰
   POSTGRES_HOST=localhost
   POSTGRES_PORT=5432
   POSTGRES_DB=zhinong_db
   POSTGRES_USER=postgres
   
   # Redisé…ç½®ï¼ˆå¦‚æœä¸ç”¨Dockerï¼‰
   REDIS_HOST=localhost
   REDIS_PORT=6379
   
   # MCPybarraå·¥ä½œæµé…ç½®
   DEFAULT_SWE_MODEL=gemini-2.5-pro
   MAX_REFINE_LOOPS=2
   ```

---

## 4ï¸âƒ£ é€‰æ‹©è¿è¡Œæ–¹å¼

### æ–¹å¼ä¸€ï¼šDockerä¸€é”®éƒ¨ç½²ï¼ˆâ­ æ¨èï¼Œæœ€ç®€å•ï¼‰

**ä¼˜ç‚¹**ï¼šæ— éœ€æ‰‹åŠ¨å®‰è£…æ•°æ®åº“ã€Redisï¼Œä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

**æ­¥éª¤**ï¼š
```bash
# 1. ç¡®ä¿å·²å®‰è£… Docker å’Œ Docker Compose
docker --version
docker-compose --version

# 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆè§æ­¥éª¤3ï¼‰
# ç¡®ä¿ backend/.env æ–‡ä»¶å·²é…ç½®å¥½

# 3. ä¸€é”®éƒ¨ç½²
cd infrastructure/docker
docker-compose up -d

# 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 5. æŸ¥çœ‹æ—¥å¿—ï¼ˆå¦‚æœ‰é—®é¢˜ï¼‰
docker-compose logs -f
```

**è®¿é—®åœ°å€**ï¼š
- APIæ–‡æ¡£ï¼šhttp://localhost:8000/docs
- å¥åº·æ£€æŸ¥ï¼šhttp://localhost:8000/health

---

### æ–¹å¼äºŒï¼šæœ¬åœ°å¼€å‘ï¼ˆé€‚åˆå¼€å‘è°ƒè¯•ï¼‰

**æ­¥éª¤**ï¼š

1. **å®‰è£…Pythonä¾èµ–**
   ```bash
   cd backend
   
   # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
   python -m venv venv
   
   # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
   # Windows:
   venv\Scripts\activate
   # Linux/Mac:
   source venv/bin/activate
   
   # å®‰è£…ä¾èµ–
   pip install -r requirements.txt
   ```

2. **å¯åŠ¨æ•°æ®åº“å’ŒRedis**ï¼ˆä½¿ç”¨Dockeræœ€ç®€å•ï¼‰
   ```bash
   # PostgreSQL
   docker run -d \
     --name zhinong-postgres \
     -e POSTGRES_DB=zhinong_db \
     -e POSTGRES_PASSWORD=postgres123 \
     -p 5432:5432 \
     postgres:15-alpine
   
   # Redis
   docker run -d \
     --name zhinong-redis \
     -p 6379:6379 \
     redis:7-alpine
   ```

3. **åˆå§‹åŒ–æ•°æ®åº“**
   ```bash
   # è¿è¡Œæ•°æ®åº“è¿ç§»
   alembic upgrade head
   
   # åˆå§‹åŒ–æ•°æ®ï¼ˆå¦‚æœæœ‰åˆå§‹åŒ–è„šæœ¬ï¼‰
   python -m backend.scripts.init_db
   ```

4. **å¯åŠ¨APIæœåŠ¡**
   ```bash
   uvicorn backend.api.main:app --reload --host 0.0.0.0 --port 8000
   ```

5. **ï¼ˆå¯é€‰ï¼‰å¯åŠ¨Workerè¿›ç¨‹**ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
   ```bash
   python -m backend.scripts.worker_daemon
   ```

---

## 5ï¸âƒ£ éªŒè¯å®‰è£…

### æ£€æŸ¥æ¸…å•

- [ ] Docker å’Œ Docker Compose å·²å®‰è£…ï¼ˆDockeræ–¹å¼ï¼‰
- [ ] Python 3.11+ å·²å®‰è£…ï¼ˆæœ¬åœ°å¼€å‘æ–¹å¼ï¼‰
- [ ] è‡³å°‘ä¸€ä¸ª LLM API å¯†é’¥å·²è·å–
- [ ] `.env` æ–‡ä»¶å·²é…ç½®ï¼ˆè‡³å°‘åŒ…å«APIå¯†é’¥å’Œæ•°æ®åº“å¯†ç ï¼‰
- [ ] æ•°æ®åº“å’ŒRediså·²å¯åŠ¨ï¼ˆæœ¬åœ°å¼€å‘æ–¹å¼ï¼‰
- [ ] ä¾èµ–å·²å®‰è£…ï¼ˆæœ¬åœ°å¼€å‘æ–¹å¼ï¼‰

### æµ‹è¯•è¿æ¥

```bash
# æµ‹è¯•APIå¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# åº”è¯¥è¿”å›ï¼š
# {"status":"healthy","version":"1.0.0","service":"ZhiNongLianXiao API"}
```

---

## 6ï¸âƒ£ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šDockerå¯åŠ¨å¤±è´¥
- **æ£€æŸ¥**ï¼šDocker Desktop æ˜¯å¦æ­£åœ¨è¿è¡Œ
- **è§£å†³**ï¼šå¯åŠ¨ Docker Desktopï¼Œç­‰å¾…å®Œå…¨å¯åŠ¨åå†è¿è¡Œå‘½ä»¤

### é—®é¢˜2ï¼šç«¯å£è¢«å ç”¨
- **æ£€æŸ¥**ï¼š`netstat -ano | findstr :8000`ï¼ˆWindowsï¼‰
- **è§£å†³**ï¼šä¿®æ”¹ `.env` ä¸­çš„ `API_PORT` æˆ–å…³é—­å ç”¨ç«¯å£çš„ç¨‹åº

### é—®é¢˜3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
- **æ£€æŸ¥**ï¼šæ•°æ®åº“æ˜¯å¦å·²å¯åŠ¨ï¼Œå¯†ç æ˜¯å¦æ­£ç¡®
- **è§£å†³**ï¼šæ£€æŸ¥ `POSTGRES_PASSWORD` é…ç½®ï¼Œç¡®ä¿æ•°æ®åº“å®¹å™¨æ­£å¸¸è¿è¡Œ

### é—®é¢˜4ï¼šAPIå¯†é’¥æ— æ•ˆ
- **æ£€æŸ¥**ï¼šAPIå¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦æœ‰ä½™é¢
- **è§£å†³**ï¼šé‡æ–°ç”ŸæˆAPIå¯†é’¥ï¼Œæ£€æŸ¥è´¦æˆ·ä½™é¢

### é—®é¢˜5ï¼šä¾èµ–å®‰è£…å¤±è´¥
- **æ£€æŸ¥**ï¼šPythonç‰ˆæœ¬æ˜¯å¦ä¸º3.11+
- **è§£å†³**ï¼šå‡çº§Pythonç‰ˆæœ¬ï¼Œæˆ–ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

---

## 7ï¸âƒ£ å¿«é€Ÿå¯åŠ¨å‘½ä»¤æ€»ç»“

### Dockeræ–¹å¼ï¼ˆæ¨èï¼‰
```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp backend/.env.example backend/.env
# ç¼–è¾‘ backend/.envï¼Œè®¾ç½® GEMINI_API_KEY å’Œ POSTGRES_PASSWORD

# 2. å¯åŠ¨æœåŠ¡
cd infrastructure/docker
docker-compose up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 4. è®¿é—®æœåŠ¡
# http://localhost:8000/docs
```

### æœ¬åœ°å¼€å‘æ–¹å¼
```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp backend/.env.example backend/.env
# ç¼–è¾‘ backend/.env

# 2. å®‰è£…ä¾èµ–
cd backend
python -m venv venv
venv\Scripts\activate  # Windows
pip install -r requirements.txt

# 3. å¯åŠ¨æ•°æ®åº“ï¼ˆDockerï¼‰
docker run -d --name postgres -p 5432:5432 -e POSTGRES_PASSWORD=postgres123 postgres:15-alpine
docker run -d --name redis -p 6379:6379 redis:7-alpine

# 4. åˆå§‹åŒ–æ•°æ®åº“
alembic upgrade head

# 5. å¯åŠ¨æœåŠ¡
uvicorn backend.api.main:app --reload --host 0.0.0.0 --port 8000
```

---

## âœ… å®Œæˆæ£€æŸ¥

è¿è¡Œé¡¹ç›®å‰ï¼Œè¯·ç¡®è®¤ï¼š

1. âœ… ç¯å¢ƒä¾èµ–å·²å®‰è£…ï¼ˆDocker æˆ– Python + æ•°æ®åº“ï¼‰
2. âœ… è‡³å°‘ä¸€ä¸ª LLM API å¯†é’¥å·²è·å–
3. âœ… `.env` æ–‡ä»¶å·²é…ç½®ï¼ˆè‡³å°‘åŒ…å«APIå¯†é’¥å’Œæ•°æ®åº“å¯†ç ï¼‰
4. âœ… æ•°æ®åº“å’ŒRediså·²å¯åŠ¨ï¼ˆæœ¬åœ°å¼€å‘æ–¹å¼ï¼‰
5. âœ… å¥åº·æ£€æŸ¥é€šè¿‡ï¼š`curl http://localhost:8000/health`

---

## ğŸ“š ä¸‹ä¸€æ­¥

å®Œæˆå‡†å¤‡å·¥ä½œåï¼Œå¯ä»¥ï¼š

1. **æŸ¥çœ‹APIæ–‡æ¡£**ï¼šhttp://localhost:8000/docs
2. **æµ‹è¯•æœåŠ¡ç”ŸæˆåŠŸèƒ½**ï¼šä½¿ç”¨APIæ–‡æ¡£ä¸­çš„ `/api/v1/services/generate` æ¥å£
3. **æŸ¥çœ‹Demoè´¦å·**ï¼š
   - æ‰‹æœºå·ï¼š`13800138000`
   - å¯†ç ï¼š`demo123456`

---

## ğŸ’¡ æç¤º

- **é¦–æ¬¡è¿è¡Œ**ï¼šå»ºè®®ä½¿ç”¨ Docker æ–¹å¼ï¼Œæœ€ç®€å•ä¸”ä¸å®¹æ˜“å‡ºé”™
- **å¼€å‘è°ƒè¯•**ï¼šä½¿ç”¨æœ¬åœ°å¼€å‘æ–¹å¼ï¼Œå¯ä»¥å®æ—¶çœ‹åˆ°ä»£ç å˜åŒ–
- **APIå¯†é’¥**ï¼šGemini å…è´¹é¢åº¦æœ€å¤§ï¼Œé€‚åˆæµ‹è¯•ä½¿ç”¨
- **é‡åˆ°é—®é¢˜**ï¼šæŸ¥çœ‹ `docker-compose logs` æˆ–åº”ç”¨æ—¥å¿—æ–‡ä»¶
